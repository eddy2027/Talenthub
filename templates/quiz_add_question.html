{% extends "base.html" %}
{% block title %}Add question · {{ quiz.title }}{% endblock %}

{% block content %}
<h1 style="margin-bottom:12px;">Add question · {{ quiz.title }}</h1>

<form method="post" style="max-width:760px;">
  {% csrf_token %}

  {% if form.non_field_errors %}
    <div style="color:#e5534b;margin-bottom:10px;">{{ form.non_field_errors }}</div>
  {% endif %}

  <div style="display:grid;grid-template-columns:1fr 160px;gap:12px;margin-bottom:12px;">
    <div>
      <label>Question</label>
      {{ form.text }}
      <div style="color:#e5534b;">{{ form.text.errors }}</div>
    </div>
    <div>
      <label>Type</label>
      {{ form.question_type }}
      <div style="color:#e5534b;">{{ form.question_type.errors }}</div>

      <label style="display:block;margin-top:8px;">Points</label>
      {{ form.points }}
      <div style="color:#e5534b;">{{ form.points.errors }}</div>
    </div>
  </div>

  <!-- MULTIPLE -->
  <div id="block-multiple" style="padding:12px;border:1px solid #2b2f36;border-radius:8px;margin-bottom:12px;">
    <div style="font-weight:600;margin-bottom:8px;">Choices (pick the correct one)</div>

    <div style="display:grid;grid-template-columns:24px 1fr;gap:8px;align-items:center;margin-bottom:6px;">
      <div>{{ form.correct_choice.as_widget }}</div>
      <div style="display:grid;grid-template-columns:1fr;gap:6px;">
        <label>Choice 1 {{ form.choice1 }}</label>
        <label>Choice 2 {{ form.choice2 }}</label>
        <label>Choice 3 {{ form.choice3 }}</label>
        <label>Choice 4 {{ form.choice4 }}</label>
      </div>
    </div>

    <div style="color:#e5534b;">
      {{ form.choice1.errors }}{{ form.choice2.errors }}{{ form.choice3.errors }}{{ form.choice4.errors }}{{ form.correct_choice.errors }}
    </div>
    <p class="secondary" style="margin:6px 0 0;">Provide at least two choices and mark which one is correct.</p>
  </div>

  <!-- TRUE/FALSE -->
  <div id="block-truefalse" style="padding:12px;border:1px solid #2b2f36;border-radius:8px;margin-bottom:12px;">
    <label style="display:inline-flex;align-items:center;gap:6px;">
      {{ form.true_is_correct }} Mark if <strong>True</strong> is the correct answer (otherwise <strong>False</strong> will be correct).
    </label>
    <div style="color:#e5534b;">{{ form.true_is_correct.errors }}</div>
  </div>

  <!-- SHORT TEXT -->
  <div id="block-short" style="padding:12px;border:1px dashed #2b2f36;border-radius:8px;margin-bottom:12px;">
    <p class="secondary" style="margin:0;">Short text answers are not auto-graded in this MVP (manual review later).</p>
  </div>

  <div style="margin-top:12px;">
    <button type="submit" name="add_more" value="1" class="btn btn-primary">Save & add another</button>
    <button type="submit" class="btn" style="margin-left:8px;">Save & finish</button>
    <a href="{% url 'quiz_list_for_course' quiz.course.id %}" class="btn" style="margin-left:8px;">Cancel</a>
  </div>
</form>

<script>
  (function () {
    const sel = document.getElementById("id_question_type");
    const blockMultiple = document.getElementById("block-multiple");
    const blockTF = document.getElementById("block-truefalse");
    const blockShort = document.getElementById("block-short");

    function update() {
      const v = sel.value;
      blockMultiple.style.display = (v === "MULTIPLE") ? "block" : "none";
      blockTF.style.display       = (v === "TRUE_FALSE") ? "block" : "none";
      blockShort.style.display    = (v === "SHORT_TEXT") ? "block" : "none";
    }
    if (sel) {
      sel.addEventListener("change", update);
      update();
    }
  })();
</script>
{% endblock %}
